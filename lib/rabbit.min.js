/*
 *@name Rabbit
 *@version v0.1.0
 *@desc An Extremely Simple MVC Library used for SPA.
 *@author VeeQun
 *@license MIT
 *@date 2014-05-04
 */
!function(a){function b(a,b){var c=g(a),e=h[c];if(e){if(e.loaded)return b(e.exports);if(e.loading)return e.module.addCallBack(b)}var i=h[c]={};return i.uri=a,(i.module=new d(f(a),c,b)).load()}function c(a){c.exports="function"==typeof a?a():a}function d(){e.apply(this,arguments)}function e(a,b,c){this.uri=a,this.id=b,this.type=e.checkoutType(a),(this.callbackList=[]).push(c),this.tag=e.createTag(this.type,a),e.bindEvents.call(this,this.tag)}function f(a){return-1==a.indexOf("http")&&(/\.(css|js)$/.test(a)||(a+=".js"),a=(0==a.indexOf("/")?"":b.config.HOST)+b.config.BASE+a),a}function g(a){return"rabbit_"+a.replace(/\//g,"_")}var h={},i=document.getElementsByTagName("head")[0],j=i.getElementsByTagName("base")[0];b.config={HOST:"/",BASE:""},d.prototype.load=function(){j?i.inserBefore(this.tag,j):i.appendChild(this.tag)},d.prototype.destroy=function(){i.removeChild(this.tag)},d.prototype.addCallBack=function(a){this.callbackList.push(a)},e.checkoutType=function(a){var b=a.lastIndexOf(".");return a.slice(++b)},e.createTag=function(a,b){var c=null;return"js"==a?(c=document.createElement("script"),c.type="text/javascript",c.async=!0,c.defer=!0,c.src=b):(c=document.createElement("link"),c.rel="stylesheet",c.type="text/css",c.href=b),c},e.bindEvents=function(a){function b(){var a=c.exports;if(!a)return!1;delete c.exports,f.destroy();for(var b=f.callbackList,d=b.length;d;)b[--d](a);h[f.id].exports=a,a=null}function d(){throw"Error: file load failed"}function e(){/complete|loaded/.test(this.readyState)&&b()}var f=this;return"onload"in a?(a.onload=b,a.onerror=d):a.onreadystatechange=e,!0},a.require=b,a.define=c}(this),function(Global){var Base={};Base.create=function(a){function b(){}function c(a){for(var b in a)this[b]=a[b]}return a=a||{},b.prototype=a,b.prototype.extend=c,new b},Base.Class=function(a,b){function c(a){for(var b in a)this[b]=a[b]}b||(b=a||{},a=function(){});var d=function(){};d.prototype=a.prototype||{};var e=function(){var c=this;this.supper=a,"function"==typeof b.__constructor__&&b.__constructor__.apply(c,arguments),"function"==typeof b.__propertys__&&b.__propertys__.apply(c,arguments),"function"==typeof b.__init__&&b.__init__.apply(c,arguments)};return e.prototype=new d,e.extend=c,e.prototype.extend=c,e.fn=e.prototype,e.prototype.proxy=function(a){var b=this;return function(){a.apply(b,arguments)}},e},Base.Utils=Base.create(),Base.Utils.extend({JSON:Global.JSON||{parse:function(jsonString){eval("return ("+jsonString+")")},stringify:function(a){function b(a){var b=Object.prototype.toString.call(a).slice(8,-1);switch(b){case"String":return'"'+a.toString()+'"';case"Date":return'"'+(a.toJSON?a.toJSON():e(a))+'"';case"Array":return d(a);case"Object":return c(a);case"Function":case"Undefined":return"null";default:return a.toString()}}function c(a){var c=[];for(var d in a)c.push('"'+d+'":'+b(a[d]));return"{"+c.join(",")+"}"}function d(a){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d]));return"["+c.join(",")+"]"}function e(a){function b(a){return 10>a?"0"+a:a}return isFinite(a.valueOf())?a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z":null}return b(a)}},queryToJson:function(a){var b=a.replace(/\&/g,",").replace(/\=/g,":");return b&&this.JSON.parse(b)},clear:function(a){return a.replace(/[\t\r\n\s]/gm,"")},is:function(){var a=Object.prototype.toString;return function(b,c){var d=a.call(b).slice(8,-1);return d.toLowerCase()==c.toLowerCase()}}()}),Global.Rabbit=Base}(this),function(a,b){var c=b.Utils.JSON,d=b.Utils.is,e=new b.Class({__constructor__:function(){this.name},__propertys__:function(a){this.name=a.name},__init__:function(){localStorage.setItem(this.name,"")}});e.fn.extend({get:function(){return c.parse(localStorage.getItem(this.name))},set:function(a){var b=this.get();if(d(b,"array"))b=b.concat(a);else for(var e in a)b[e]=a[e];localStorage.setItem(this.name,c.stringify(b))}}),b.Model=e}(this,Rabbit),function(a,b){var c=b.Utils.is,d=new b.Class({__constructor__:function(){this.isCreated},__propertys__:function(){this.isCreated=!1},__init__:function(a){if(!c(a,"object"))return!1;for(var b in a)this[b]=a[b]}});d.fn.extend({onCreate:function(){},onLoad:function(){},onShow:function(){},onHide:function(){},start:function(){}}),b.View=d}(this,Rabbit),function(a,b){var c=new b.Class({__constructor__:function(a){this.router={},this.currentView="",this.config={VIEW_HOST:a.VIEW_HOST||"/",VIEW_BASE:a.VIEW_BASE||"",VIEW_DEFAULT:"index",MAIN_CONTAINER:a.MAIN_CONTAINER||document.body}},__init__:function(){this.hashChange(),a.onhashchange=this.proxy(this.hashChange)}});c.fn.extend({hashChange:function(){var a=this.getViewInfo();this.switchView(a)},switchView:function(a){function c(c){f.view=c,c.param=b.Utils.queryToJson(a.query),this.create(c,e),this.render(c),this.viewLoaded(c)}var d=null,e=this.getViewUri(a.path),f=this.router[e]||(this.router[e]={});return(d=f.view)?(d.param=b.Utils.queryToJson(a.query),this.viewLoaded(d)):require(e,this.proxy(c)),!0},create:function(a,b){var c=this.createContainer();b.container=c.container,b.id=c.id,a.el=c.container,a.viewID=c.id,a.onCreate()},render:function(a){this.config.MAIN_CONTAINER.appendChild(a.el)},viewLoaded:function(a){a.onLoad(),this.swapView(a),a.start()},swapView:function(a){var b;(b=this.currentView)&&!!(b.el.style.display="none")&&b.onHide(),this.currentView=a,a.el.style.display="",a.onShow()},getViewInfo:function(){var a=location.hash.split("?");return{path:(a[0]||"#"+this.config.VIEW_DEFAULT).replace("#","/"),query:a[1]||""}},getViewUri:function(a){return this.config.VIEW_HOST+this.config.VIEW_BASE+a},createContainer:function(){var a=0,b="rabbit-view-";return function(){var c=document.createElement("div"),d=b+ ++a;return c.id=d,c.style.display="none",{container:c,id:d}}}()}),b.Controller=c}(this,Rabbit);